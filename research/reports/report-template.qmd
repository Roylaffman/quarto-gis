---
title: "GIS Research Report Template"
subtitle: "Findings • Maps • Recommendations"
author: "Ryan Lafferty"
date: last-modified
format:
  html:
    toc: true
    number-sections: true
    embed-resources: true
    code-tools: true
jupyter: python3
---

```{python}
#| echo: false
import sys
sys.path.append("..")  # resolve imports from reports/ → research/

from db_connection import query_to_geodataframe, query_to_dataframe
from map_builder import create_base_map, add_geodataframe_layer, add_point_markers, finalize_map
```

## Executive summary

- **What changed?**
- **What matters?**
- **What you recommend next?**

---

## Context and objectives

Describe the decision context (who uses this, what decisions it informs), and the research questions.

---

## Data and methods

{{< include ../inserts/methods-block.qmd >}}

### Data acquisition

```{python}
#| eval: false
# Pull spatial data from PostGIS
gdf = query_to_geodataframe("""
    SELECT id, name, category, geom
    FROM your_schema.your_table
    WHERE condition = 'value'
""")
print(f"{len(gdf)} features loaded")
gdf.head()
```

---

## Results

### Key map

```{python}
#| eval: false
m = create_base_map(gdf=gdf, zoom=10, tiles="positron")
m = add_geodataframe_layer(
    m, gdf,
    name="Results",
    tooltip_fields=["name", "category"],
    style={"color": "#0ea5e9", "weight": 2, "fillOpacity": 0.4},
)
m = finalize_map(m)
m
```

### Key figure

{{< include ../inserts/figure-callout.qmd >}}

---

## Interpretation

Write the "so what":
- Drivers / causal hypotheses
- Confounders and uncertainty
- Sensitivity checks you ran (or need to run)

---

## Recommendations

1. **Action A** — why, owner, expected impact
2. **Action B** — why, owner, expected impact

---

## Appendix

### Reproducibility

```{python}
import sys, geopandas as gpd, pandas as pd
print("Python:", sys.version.split()[0])
print("GeoPandas:", gpd.__version__)
print("Pandas:", pd.__version__)
```

### References

If you use citations, add entries to `reports/references.bib` and cite like `[@somekey]`.
